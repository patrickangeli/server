name: Telegram Torrent Bot

on:
  workflow_dispatch:

jobs:
  download:
    runs-on: ubuntu-latest
    steps:
      - name: Install Dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y rclone python3-pip
          pip3 install python-telegram-bot rclone-python
          
      - name: Configure Rclone
        env:
          RCLONE_CONFIG: ${{ secrets.RCLONE_CONFIG }}
        run: |
          mkdir -p ~/.config/rclone
          echo "$RCLONE_CONFIG" > ~/.config/rclone/rclone.conf
          
      - name: Setup Telegram Bot
        uses: appleboy/telegram-action@master
        with:
          to: ${{ secrets.TELEGRAM_ID }}
          token: ${{ secrets.TELEGRAM_TOKEN }}
          format: markdown
          message: "Bot iniciado e pronto para receber torrents"
          
      - name: Mount Rclone Drive
        run: |
          mkdir /mnt/drive
          rclone mount remote:path /mnt/drive &
          
      - name: Download Torrent
        run: |
          python3 process_torrent.py
